{% extends 'padre.html' %}
{% load static %}

{% block title %}Seguimiento de Compras - Luminova{% endblock %}

{% block sidebar_content %}
    {% include 'compras/compras_sidebar.html' %}
{% endblock %}

{% block content %}
<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
    <h1 class="h2 fw-bold text-primary">Seguimiento de Órdenes de Compra</h1>
</div>

<ul class="nav nav-tabs" id="ocTabs" role="tablist">
  {% for estado, nombre, ocs in estados_oc_tabs %}
    <li class="nav-item" role="presentation">
      <button class="nav-link {% if forloop.first %}active{% endif %}" id="tab-{{ estado }}" data-bs-toggle="tab" data-bs-target="#tab-content-{{ estado }}" type="button" role="tab" aria-controls="tab-content-{{ estado }}" aria-selected="{% if forloop.first %}true{% else %}false{% endif %}">{{ nombre }}</button>
    </li>
  {% endfor %}
</ul>
<div class="tab-content mt-3" id="ocTabsContent">
  {% for estado, nombre, ocs in estados_oc_tabs %}
    <div class="tab-pane fade {% if forloop.first %}show active{% endif %}" id="tab-content-{{ estado }}" role="tabpanel" aria-labelledby="tab-{{ estado }}">
      <div class="table-responsive">
        <table class="table table-hover table-sm align-middle">
          <thead class="color-thead">
            <tr>
              <th class="align-middle">N° OC</th>
              <th class="align-middle">Estado de OC</th>
              <th class="align-middle">Proveedor</th>
              <th class="align-middle">Fecha Estimada de Entrega</th>
              <th class="align-middle">N° Tracking</th>
            </tr>
          </thead>
          <tbody>
            {% for oc in ocs %}
            <tr>
              <td class="align-middle">
                  <a href="{% url 'App_LUMINOVA:compras_detalle_oc' oc.id %}">{{ oc.numero_orden }}</a>
              </td>
              <td class="align-middle">
                  <span class="badge bg-success-subtle text-success-emphasis border border-success-subtle">
                      {{ oc.get_estado_display }}
                  </span>
              </td>
              <td class="align-middle">{{ oc.proveedor.nombre }}</td>
              <td class="align-middle">{{ oc.fecha_estimada_entrega|date:"d/m/Y"|default:"No especificada" }}</td>
              <td>
                {% if oc.numero_tracking %}
                  <a href="{% url 'App_LUMINOVA:compras_tracking_pedido' oc.id %}" class="btn btn-sm btn-outline-primary">
                      <i class="bi bi-truck me-1"></i> {{ oc.numero_tracking }}
                  </a>
                {% else %}
                  N/A
                {% endif %}
              </td>
            </tr>
            {% empty %}
            <tr>
              <td colspan="5" class="text-center fst-italic text-muted py-3">No hay órdenes en este estado.</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  {% endfor %}
</div>
{% endblock %}